<div class="container mt-5">
  <h1 class="text-center">日記詳細</h1>

  <div class="card mt-4 bg-light">
    <div class="card-body">

      <!-- ユーザー情報 -->
      <div class="d-flex align-items-center mb-3">
        <%= image_tag @diary.user.get_profile_image(100,100), class: "mr-3 rounded-circle" %>
        <div>
          <%= link_to my_page_user_path(@diary.user.id) do %>
            <p class="font-weight-bold mb-0"><%= @diary.user.nickname %></p>
          <% end %>
          <%= render 'public/relationships/follow_btn', user: @diary.user %>
        </div>
      </div>

      <!-- 画像 -->
      <div class="container mt-5">
        <div class="row justify-content-center">
          <div class="col-md-8">
               <% if  @diary.images.attached? %>
                <%  @diary.images.each do |image| %>
                  <%= image_tag image, class: "img-fluid ", size: "700x700" %>
                <% end %>
              <% end %>
          </div>
        </div>
      </div>

      
  
      <!-- 詳細情報 -->
      <p><%= render 'public/diaries/tag', diary: @diary %></p> 
      <p class="font-weight-bold"><%= @diary.title %></p>
      <!--本文を改行ありで表示-->
      <p><%=safe_join(@diary.body.split("\n"),tag(:br))%></p>
      <p>体重： <%= @diary.weight %> kg</p>
     
      <!-- いいねとコメント -->
      <p><%= render 'public/diaries/favorite', diary: @diary %></p>
      <p><i class="far fa-comment"></i> <%=@diary.diary_comments.count %></p>
      <% @diary.diary_comments.each do |diary_comment| %>
          <div class="comment">
            <%= link_to my_page_user_path(diary_comment.user) do %>
              <%= diary_comment.user.nickname %>
            <% end %>
            <%= diary_comment.created_at.strftime('%Y/%m/%d') %>
            <%= diary_comment.comment %>
            <% if diary_comment.user == current_user %>
              <%= link_to "削除", diary_diary_comment_path(diary_comment.diary, diary_comment), method: :delete %>
            <% end %>
          </div>
      <% end %>

      <!-- コメントフォーム -->
     <div class="mt-3">
       <%= form_with model: [@diary, @diary_comment], class: "mb-3" do |f| %>
         <%= f.text_area :comment, rows: '5', placeholder: "コメントをここに", class: "form-control mb-2" %>
         <%= f.submit "送信する", class: "btn btn-primary text-right" %>
       <% end %>
     </div>

      <!-- 編集・削除ボタン -->
      <div class="container mt-5">
        <div class="row justify-content-center">
          <% if @diary.user == current_user %> 
           <%= link_to "編集する", edit_diary_path(@diary), class: "btn btn-success mr-3 " %>
           <%= link_to "削除", diary_path(@diary.id), method: :delete, class: "btn btn-danger", "data-confirm" => "本当に削除しますか？" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

</div>

